# Правила работы ИИ агентов

## Связанные правила

Перед началом работы с проектом ознакомься со следующими правилами:

- [Стандарты написания кода](./coding-standards.md) - TypeScript типизация, именование, компоненты, MobX stores, DI (в т.ч. типизация входящих props через `Props<ModelProps>` в ViewModel), React Three Fiber, производительность
- [Организация файлов](./file-organization.md) - экспорты, импорты, структура директорий
- [Обзор проекта](./project-overview.md) - требования к окружению, основные зависимости
- [Правила стилизации](./styling-rules.md) - Tailwind CSS и форматирование кода

## Создание нового функционала

При добавлении нового функционала (компоненты, сервисы, виджеты, утилиты и т.п.) **обязательно** писать к нему тесты. Тесты должны покрывать основное поведение и граничные случаи. Файлы тестов размещать рядом с кодом (например, `Component.test.tsx`) или в соответствующей структуре тестов проекта.

## Обязательные проверки перед завершением задачи

При выполнении любых изменений, затрагивающих следующие типы файлов, ИИ агент **ОБЯЗАН** запустить проверки:

- `*.js` - JavaScript файлы
- `*.ts` - TypeScript файлы
- `*.tsx` - TypeScript React компоненты
- `*.css` - CSS файлы

## Последовательность проверок

### 1. Линтинг кода

```bash
npm run lint:fix
```

Автоматически исправляет проблемы форматирования и стиля кода.

### 2. Линтинг стилей

```bash
npm run lint:styles:fix
```

Проверяет и исправляет CSS файлы согласно Stylelint правилам.

### 3. Проверка типов TypeScript

```bash
npm run check-types
```

Проверяет корректность типов во всех TypeScript файлах.

### 4. Тесты (когда будут добавлены)

```bash
npm test
# или
npm run test
```

Запускает тесты проекта. Команда будет добавлена позже, но ИИ агент должен её запускать при наличии.

## Когда запускать проверки

Проверки должны запускаться:

1. **После завершения задачи** - перед финальным коммитом изменений
2. **После рефакторинга** - при изменении структуры кода
3. **После добавления новых файлов** - при создании новых компонентов или утилит; при этом к новому функционалу обязательно пишутся тесты (см. раздел «Создание нового функционала»)
4. **После исправления багов** - для подтверждения что исправления не сломали существующий код

## Обработка ошибок

Если проверки выявили ошибки:

1. **Линтинг ошибки** - исправить автоматически через `lint:fix` и `lint:styles:fix`
2. **Ошибки типов** - исправить типы TypeScript
3. **Падающие тесты** - исправить код или тесты до прохождения всех проверок

## Исключения

Проверки можно пропустить только если:

- Изменения касаются только документации (`.md` файлы)
- Пользователь явно попросил не запускать проверки

## Важно

- Все проверки должны пройти успешно перед завершением задачи
